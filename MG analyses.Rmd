---
title: "MA DMF Middle Ground"
author: "Randall Hughes"
date: "10/12/2017"
output:
  pdf_document: default
  html_document: default
---

#Randall test

#Packages
```{r}
#data management
library(dplyr)

#time series
library(tidyverse)
library(dplyr)
library(lubridate)
library(EnvStats)

#plotting
library(ggplot2)
library(sciplot)
library(multcompView)
```


#Importing Data
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
mg <- read.csv("MG_restoration_data.csv", header=T)
mg$no.sites <- as.factor(mg$no.sites)
str(mg)

mg$sample.date <- ymd(mg$sample.date)
mg <- mg %>% 
  mutate(
    yr = year(sample.date), 
    mo = month(sample.date))
```

#Spring 2017 PLANTING
##1 Month Monitoring Analyses
```{r}
#Data organization
mg.spring2017.1month <- filter(mg, mg$planting.date == "Spring.2017" & mg$sample.point == "1month")
str(mg.spring2017.1month)
```

###Shoot density
```{r}
#Data management- excluding plot with no discs remaining
mg.spring2017.1month.den <- subset(mg.spring2017.1month, shoots.per.disc > 0)

#Model 1
model = lm(no.shoots ~ diversity.treatment + identity + no.discs + transect, data = mg.spring2017.1month.den)
anova(model) #diversity, identity, no.discs --> significant
plot(shoots.per.disc ~ diversity.treatment, ylim = c(0,25), data = mg.spring2017.1month.den)
plot(shoots.per.disc ~ identity, data = mg.spring2017.1month.den)

#Model 2: diversity (parsed between 3 and 5); number of discs as covariate; transect removed
model = lm(no.shoots ~ no.sites + identity + no.discs, data=mg.spring2017.1month.den)
anova(model) #identity, no.discs, diversity --> significant
plot(shoots.per.disc ~ no.sites, ylim = c(0,25), data = mg.spring2017.1month.den)
bargraph.CI(x.factor = no.sites, response = shoots.per.disc, data = mg.spring2017.1month.den, ylim = c(0,20), main = "Spring 2017 1 month")

#Model3: differences between mean mono and mean poly for poly 3 and poly 5 looking for overyielding
##5poly
###Data management
mg.spring2017.1month.den.Poly5 <- filter(mg.spring2017.1month.den, no.sites != "3")

###model
model.5poly = lm(no.shoots ~ no.sites + identity + no.discs, data=mg.spring2017.1month.den.Poly5)
anova(model.5poly) #no.discs, no.sites, identity --> significant; mono > poly
plot(shoots.per.disc ~ no.sites, ylim = c(0,25), data = mg.spring2017.1month.den.Poly5)
bargraph.CI(x.factor = no.sites, response = shoots.per.disc, data = mg.spring2017.1month.den.Poly5, ylim = c(0,20), main = "Spring 2017 1 month")

##3poly
###Data management
mg.spring2017.1month.den.Poly3 <- subset(mg.spring2017.1month.den, identity == "Niles" | identity == "Poly 3" | identity == "West" | identity == "Lynn" )

###model
model.3poly = lm(no.shoots ~ no.sites + identity + no.discs, data=mg.spring2017.1month.den.Poly3)
anova(model.3poly) #no.discs and identity --> significant, no overyielding
plot(shoots.per.disc ~ identity, data = mg.spring2017.1month.den.Poly3, ylim = c(0,15))
plot(shoots.per.disc ~ no.sites, ylim = c(0,25), data = mg.spring2017.1month.den.Poly3)
bargraph.CI(x.factor = no.sites, response = shoots.per.disc, data = mg.spring2017.1month.den.Poly3, ylim = c(0,20), main = "Spring 2017 1 month")
```

###Percent cover
```{r}
#Percent cover - differences by transect; number of discs as covariate
model = lm(percent.cover ~ diversity.treatment + identity + no.discs + transect , data = mg.spring2017.1month)
anova(model)

#percent cover - differences by diversity (parsed between 3 and 5), identity; number of discs as covariate; transect removed
model = lm(percent.cover ~ no.sites + identity + no.discs, data = mg.spring2017.1month)
anova(model) #why is identity excluded from output?       ##########???################
```

###Canopy height
```{r}
#Data management: removing data points with canopy height of 0
mg.spring2017.1month.ch <- subset(mg.spring2017.1month, canopy.height > 0)

#Model 1: by diversity and identity; number of discs as covariate (but not sure why it matters?)
model = lm(canopy.height ~ diversity.treatment + identity + no.discs + transect , data = mg.spring2017.1month.ch)
anova(model) #diversity, identity --> significant; no.discs --> marginal significance
plot(canopy.height ~ diversity.treatment, data = mg.spring2017.1month.ch)
plot(canopy.height ~ identity, data = mg.spring2017.1month.ch)
plot(canopy.height ~ no.discs, data = mg.spring2017.1month.ch)

#Model 2: diversity (parsed between 3 and 5); transect removed
model = lm(canopy.height ~ no.sites + identity + no.discs, data = mg.spring2017.1month.ch)
anova(model) #identity, diversity --> significant; no.discs --> marginally significant
plot(canopy.height ~ no.sites, data = mg.spring2017.1month.ch)

#Model3: differences between mean mono and mean poly for poly 3 and poly 5 looking for overyielding
##5poly
###Data management
mg.spring2017.1month.ch.Poly5 <- filter(mg.spring2017.1month.ch, no.sites != "3")

###model
model.5poly = lm(canopy.height ~ no.sites + identity + no.discs, data=mg.spring2017.1month.ch.Poly5)
anova(model.5poly) #no.sites, identity, no discs --> significant; overyielding, not transgressive overyielding
plot(canopy.height ~ no.sites, data = mg.spring2017.1month.ch.Poly5)
plot(canopy.height ~ identity, data = mg.spring2017.1month.ch.Poly5)

##3poly
###Data management
mg.spring2017.1month.ch.Poly3 <- subset(mg.spring2017.1month.ch, identity == "Niles" | identity == "Poly 3" | identity == "West" | identity == "Lynn" )

###model
model.3poly = lm(canopy.height ~ no.sites + identity + no.discs, data=mg.spring2017.1month.ch.Poly3)
anova(model.3poly) # identity and no.sites --> significant; no overyielding
plot(canopy.height ~ no.sites, data = mg.spring2017.1month.ch.Poly3)
plot(canopy.height ~ identity, data = mg.spring2017.1month.den.Poly3)
```

###Discs per plot
```{r}
#Model
model = lm(no.discs ~ no.sites + identity + transect, data = mg.spring2017.1month)
anova(model) # transect:planting.date and no.sites:planting.date --> significant

bargraph.CI(x.factor = identity, response = no.discs, data = mg, legend = T, x.leg = 7, y.leg =6, ylim = c(0,6)) #spring poly5s had fewer discs remaining after 1 month
```


##6 Month Monitoring Analysis
```{r}
#Data organization
mg.spring2017.6month <- filter(mg, mg$planting.date == "Spring.2017" & mg$sample.point == "6month")
str(mg.spring2017.6month)
```

###Shoot density
```{r}
#Data management- excluding plot with no discs remaining
mg.spring2017.6month.den <- subset(mg.spring2017.6month, shoots.per.disc > 0)

#Model 1
model = lm(no.shoots ~ diversity.treatment + identity + no.discs + transect, data = mg.spring2017.6month.den)

model = lm(shoots.per.disc ~ diversity.treatment + identity + transect, data = mg.spring2017.6month.den)

anova(model) #diversity, identity, no.discs --> significant; transect marginally signficiant
plot(shoots.per.disc ~ diversity.treatment, ylim = c(0,30), data = mg.spring2017.6month.den)
plot(shoots.per.disc ~ identity, ylim = c(0,30), data = mg.spring2017.6month.den)
bargraph.CI(x.factor = identity, response = shoots.per.disc, data = mg.spring2017.6month.den, ylim = c(0,20), main = "Spring 2017 6 month")

#Model 2: diversity (parsed between 3 and 5); number of discs as covariate; transect removed
model = lm(no.shoots ~ no.sites + identity + no.discs, data=mg.spring2017.6month.den)

model = lm(shoots.per.disc ~ no.sites + identity, data=mg.spring2017.6month.den)

anova(model) #identity, no.discs, diversity --> significant
plot(shoots.per.disc ~ no.sites, ylim = c(0,25), data = mg.spring2017.6month.den)

#Model3: differences between mean mono and mean poly for poly 3 and poly 5 looking for overyielding
##5poly
###Data management
mg.spring2017.6month.den.Poly5 <- filter(mg.spring2017.6month.den, no.sites != "3")

###model
model.5poly = lm(no.shoots ~ no.sites + identity + no.discs, data=mg.spring2017.6month.den.Poly5)
anova(model.5poly) #no.discs, no.sites, identity --> significant; poly < mono
plot(shoots.per.disc ~ no.sites, ylim = c(0,25), data = mg.spring2017.6month.den.Poly5)
bargraph.CI(x.factor = no.sites, response = shoots.per.disc, data = mg.spring2017.6month.den.Poly5, ylim = c(0,20), main = "Spring 2017 6 month")

##3poly
###Data management
mg.spring2017.6month.den.Poly3 <- subset(mg.spring2017.6month.den, identity == "Niles" | identity == "Poly 3" | identity == "West" | identity == "Lynn" )

###model
model.3poly = lm(no.shoots ~ no.sites + identity + no.discs, data=mg.spring2017.6month.den.Poly3)
anova(model.3poly) #no.discs --> significant, no overyielding
plot(shoots.per.disc ~ identity, data = mg.spring2017.6month.den.Poly3, ylim = c(0,25))
plot(shoots.per.disc ~ no.sites, data = mg.spring2017.6month.den.Poly3, ylim = c(0,25))
bargraph.CI(x.factor = no.sites, response = shoots.per.disc, data = mg.spring2017.6month.den.Poly3, ylim = c(0,20), main = "Spring 2017 6 month")
```

###Percent cover
```{r}
#Percent cover - differences by transect; number of discs as covariate
model = lm(percent.cover ~ diversity.treatment + identity + no.discs + transect , data = mg.spring2017.6month)
anova(model)
  ##diversity, identity, no.discs are significant
plot(percent.cover ~ identity, data = mg.spring2017.6month, ylim = c(0,100))
plot(percent.cover ~ diversity.treatment, data = mg.spring2017.6month, ylim = c(0,100))

#percent cover - differences by diversity (parsed between 3 and 5), identity; number of discs as covariate; transect removed
model = lm(percent.cover ~ no.sites + identity + no.discs, data = mg.spring2017.6month)
anova(model) #no.sites and identity significant

plot(percent.cover ~ no.sites, data = mg.spring2017.6month, ylim = c(0,100))

#****************************************************************************************************************************
```

###Canopy height
```{r}
#Data management: removing data points with canopy height of 0
mg.spring2017.6month.ch <- subset(mg.spring2017.6month, canopy.height > 0)

#Model 1: by diversity and identity; number of discs as covariate (but not sure why it matters?)
model = lm(canopy.height ~ diversity.treatment + identity + no.discs + transect , data = mg.spring2017.6month.ch)
anova(model) #no.discs, identity --> significant
plot(canopy.height ~ diversity.treatment, data = mg.spring2017.6month.ch)
plot(canopy.height ~ identity, data = mg.spring2017.6month.ch)
plot(canopy.height ~ no.discs, data = mg.spring2017.6month.ch)

#Model 2: diversity (parsed between 3 and 5); transect removed
model = lm(canopy.height ~ no.sites + identity + no.discs, data = mg.spring2017.6month.ch)
anova(model) #identity, no.discs --> significant
plot(canopy.height ~ no.sites, data = mg.spring2017.6month.ch)

#Model3: differences between mean mono and mean poly for poly 3 and poly 5 looking for overyielding
##5poly
###Data management
mg.spring2017.6month.ch.Poly5 <- filter(mg.spring2017.6month.ch, no.sites != "3")

###model
model.5poly = lm(canopy.height ~ no.sites + identity + no.discs, data=mg.spring2017.6month.ch.Poly5)
anova(model.5poly) #identity, no discs --> significant; no.sites -->marginally significant
plot(canopy.height ~ no.sites, data = mg.spring2017.6month.ch.Poly5)
plot(canopy.height ~ identity, data = mg.spring2017.6month.ch.Poly5)

##3poly
###Data management
mg.spring2017.6month.ch.Poly3 <- subset(mg.spring2017.6month.ch, identity == "Niles" | identity == "Poly 3" | identity == "West" | identity == "Lynn" )

###model
model.3poly = lm(canopy.height ~ no.sites + identity + no.discs, data=mg.spring2017.6month.ch.Poly3)
anova(model.3poly) #no.discs --> significant
plot(canopy.height ~ no.sites, data = mg.spring2017.6month.ch.Poly3)
plot(canopy.height ~ identity, data = mg.spring2017.6month.den.Poly3)
```

###Discs per plot
```{r}
#Model
model = lm(no.discs ~ no.sites + identity + transect, data = mg.spring2017.6month)
anova(model) # transect:planting.date and no.sites:planting.date --> significant

bargraph.CI(x.factor = identity, response = no.discs, data = mg.spring2017.6month, legend = T, x.leg = 7, y.leg =6, ylim = c(0,6)) #spring poly5s had fewer discs remaining after 1 month
```

##11 Month Monitoring
```{r}
#Data organization
mg.spring2017.11month <- filter(mg, mg$planting.date == "Spring.2017" & mg$sample.point == "11month")
str(mg.spring2017.11month)
```

###Shoot density
```{r}
#Model 1
model = lm(shoots.per.disc ~ diversity.treatment + identity + no.discs + transect, data = mg.spring2017.11month)
anova(model) #no significant factors
plot(shoots.per.disc ~ diversity.treatment, ylim = c(0,30), data = mg.spring2017.11month)
plot(shoots.per.disc ~ identity, ylim = c(0,30), data = mg.spring2017.11month)
bargraph.CI(x.factor = identity, response = shoots.per.disc, data = mg.spring2017.11month, ylim = c(0,20), main = "Spring 2017 11 month")

#Model 2: diversity (parsed between 3 and 5); number of discs as covariate; transect removed
model = lm(shoots.per.disc ~ no.sites + identity + no.discs, data=mg.spring2017.11month)
anova(model) #no significant factors
plot(shoots.per.disc ~ no.sites, ylim = c(0,25), data = mg.spring2017.11month)

#Model3: differences between mean mono and mean poly for poly 3 and poly 5 looking for overyielding
##5poly
###Data management
mg.spring2017.11month.Poly5 <- filter(mg.spring2017.11month, no.sites != "3")

###model
model.5poly = lm(shoots.per.disc ~ no.sites + identity + no.discs, data=mg.spring2017.11month.Poly5)
anova(model.5poly) #no.discs--> significant; identity -->marginally significant
plot(shoots.per.disc ~ identity, data = mg.spring2017.11month.Poly5)
bargraph.CI(x.factor = identity, response = shoots.per.disc, data = mg.spring2017.11month.Poly5, ylim = c(0,45), ylab = "Shoots per disc", xlab = "identity")
bargraph.CI(x.factor = no.sites, response = shoots.per.disc, data = mg.spring2017.11month.Poly5, ylim = c(0,20), ylab = "Shoots per disc")

##3poly
###Data management
mg.spring2017.11month.Poly3 <- subset(mg.spring2017.11month, identity == "Niles" | identity == "Poly 3" | identity == "West" | identity == "Lynn" )

###model
model.3poly = lm(no.shoots ~ no.sites + identity + no.discs, data=mg.spring2017.11month.Poly3)
anova(model.3poly) #identity and no.discs --> significant
plot(shoots.per.disc ~ identity, data = mg.spring2017.11month.Poly3)
bargraph.CI(x.factor = identity, response = shoots.per.disc, data = mg.spring2017.11month.Poly3, ylim = c(0,45), ylab = "Shoots per disc", xlab = "Identity")
bargraph.CI(x.factor = no.sites, response = shoots.per.disc, data = mg.spring2017.11month.Poly3, ylim = c(0,20), ylab = "Shoots per disc")
```


###Percent cover
```{r}
#Percent cover - differences by transect; number of discs as covariate
model = lm(percent.cover ~ diversity.treatment + identity + no.discs + transect , data = mg.spring2017.11month)
anova(model)
  ##diversity, identity, no.discs are significant
plot(percent.cover ~ identity, data = mg.spring2017.11month, ylim = c(0,100))
plot(percent.cover ~ diversity.treatment, data = mg.spring2017.11month, ylim = c(0,100))

#percent cover - differences by diversity (parsed between 3 and 5), identity; number of discs as covariate; transect removed
model = lm(percent.cover ~ no.sites + identity + no.discs, data = mg.spring2017.11month)
anova(model) #no.sites, identity significant, and no.discs significant

plot(percent.cover ~ no.sites, data = mg.spring2017.11month, ylim = c(0,100))

#****************************************************************************************************************************
```

###Canopy height
```{r}
#Model 1: by diversity and identity; number of discs as covariate (but not sure why it matters?)
model = lm(canopy.height ~ diversity.treatment + identity + no.discs + transect , data = mg.spring2017.11month)
anova(model) #no.discs, identity --> significant
plot(canopy.height ~ identity, data = mg.spring2017.11month)
bargraph.CI(x.factor = identity, response = canopy.height, data = mg.spring2017.11month, ylim = c(0,45), ylab = "canopy height (cm)", xlab = "Identity")
plot(canopy.height ~ no.discs, data = mg.spring2017.11month)

#Model 2: diversity (parsed between 3 and 5); transect removed
model = lm(canopy.height ~ no.sites + identity + no.discs, data = mg.spring2017.11month)
anova(model) #identity, no.discs --> significant
plot(canopy.height ~ no.sites, data = mg.spring2017.11month)

#Model3: differences between mean mono and mean poly for poly 3 and poly 5 looking for overyielding
##5poly
###Data management
mg.spring2017.11month.Poly5 <- filter(mg.spring2017.11month, no.sites != "3")

###model
model.5poly = lm(canopy.height ~ no.sites + identity + no.discs, data=mg.spring2017.11month.Poly5)
anova(model.5poly) #identity--> significant; no.discs -->marginally significant
plot(canopy.height ~ no.sites, data = mg.spring2017.11month.Poly5)
plot(canopy.height ~ identity, data = mg.spring2017.11month.Poly5)
plot(canopy.height ~ no.discs, data = mg.spring2017.11month.Poly5)

##3poly
###Data management
mg.spring2017.11month.Poly3 <- subset(mg.spring2017.11month, identity == "Niles" | identity == "Poly 3" | identity == "West" | identity == "Lynn" )

###model
model.3poly = lm(canopy.height ~ no.sites + identity + no.discs, data=mg.spring2017.11month.Poly3)
anova(model.3poly) #no.sites and no.discs --> significant
plot(canopy.height ~ no.sites, data = mg.spring2017.11month.Poly3)
bargraph.CI(x.factor = no.sites, response = canopy.height, data = mg.spring2017.11month.Poly3, ylim = c(0,45), ylab = "canopy height (cm)", xlab = "Number of sites")
plot(canopy.height ~ identity, data = mg.spring2017.11month.Poly3)
plot(canopy.height ~ no.discs, data = mg.spring2017.11month.Poly3)
```

###Discs per plot
```{r}
#Model
model = lm(no.discs ~ no.sites + identity + transect, data = mg.spring2017.11month)
anova(model) # transect:planting.date and no.sites:planting.date --> significant effects of no.sites, identity and transect

bargraph.CI(x.factor = transect, response = no.discs, data = mg.spring2017.11month, legend = T, x.leg = 7, y.leg =6, ylim = c(0,6)) #spring poly5s had fewer discs remaining after 11 month
```

#FALL 2017 PLANTING
##1 Month Monitoring Analyses
```{r}
#Data organization
mg.fall2017.1month <- filter(mg, planting.date == "Fall.2017" & sample.point == "1month")
mg.fall2017.1month$no.sites <- as.factor(mg.fall2017.1month$no.sites)
str(mg.fall2017.1month)
```

###Shoot density
```{r}
#Data management- excluding plot with no discs remaining
mg.fall2017.1month.den <- subset(mg.fall2017.1month, shoots.per.disc > 0)

#Model 1
model = lm(no.shoots ~ diversity.treatment + identity + no.discs + transect, data = mg.fall2017.1month.den)

#model = lm(shoots.per.disc ~ diversity.treatment + identity + transect, data = mg.fall2017.1month.den)

anova(model) #identity, no.discs --> significant
plot(shoots.per.disc ~ diversity.treatment, data = mg.fall2017.1month.den)
plot(shoots.per.disc ~ identity, data = mg.fall2017.1month.den)
bargraph.CI(x.factor = identity, response = shoots.per.disc, data = mg.fall2017.1month.den, ylim = c(0,20), main = "Fall 2017 1 month")

#Model 2: diversity (parsed between 3 and 5); number of discs as covariate; transect removed
model = lm(no.shoots ~ no.sites + identity + no.discs, data=mg.fall2017.1month.den)
anova(model) #identity, no.discs --> significant;
plot(shoots.per.disc ~ no.sites, data = mg.fall2017.1month.den)

#Model3: differences between mean mono and mean poly for poly 3 and poly 5 looking for overyielding
##5poly
###Data management
mg.fall2017.1month.den.Poly5 <- filter(mg.fall2017.1month.den, no.sites != "3")

###model
model.5poly = lm(no.shoots ~ no.sites + identity + no.discs, data=mg.fall2017.1month.den.Poly5)
anova(model.5poly) #no.discs, identity --> significant; no overyielding

bargraph.CI(x.factor = no.sites, response = shoots.per.disc, data = mg.fall2017.1month.den.Poly5, ylim = c(0,20), main = "Fall 2017 1 month")

##3poly
###Data management
mg.fall2017.1month.den.Poly3 <- subset(mg.fall2017.1month.den, identity == "Niles" | identity == "Poly 3" | identity == "West" | identity == "Nahant" )

###model
model.3poly = lm(no.shoots ~ no.sites + identity + no.discs, data=mg.fall2017.1month.den.Poly3)

#model.3poly = lm(shoots.per.disc ~ no.sites + identity, data=mg.fall2017.1month.den.Poly3 )

anova(model.3poly) #no.discs and no.sites(diversity) --> significant, overyielding, but not transgressive overyielding
plot(shoots.per.disc ~ no.sites, data = mg.fall2017.1month.den.Poly3, ylim = c(0,15))
plot(shoots.per.disc ~ identity, data = mg.fall2017.1month.den.Poly3, ylim = c(0,15))
bargraph.CI(x.factor = no.sites, response = shoots.per.disc, data = mg.fall2017.1month.den.Poly3, ylim = c(0,20), main = "Fall 2017 1 month")

```

###Percent cover
```{r}
#Percent cover - differences by transect; number of discs as covariate
model = lm(percent.cover ~ diversity.treatment + identity + no.discs + transect , data = mg.fall2017.1month)
anova(model)
plot(percent.cover ~ transect, data = mg.fall2017.1month)

#percent cover - differences by diversity (parsed between 3 and 5), identity; number of discs as covariate; transect removed
model = lm(percent.cover ~ no.sites + identity + no.discs, data = mg.fall2017.1month)
anova(model)
```

###Canopy height
```{r}
#Data management: removing data points with canopy height of 0
mg.fall2017.1month.ch <- subset(mg.fall2017.1month, canopy.height > 0)

#Model 1: by diversity and identity; number of discs as covariate (but not sure why it matters?)
model = lm(canopy.height ~ diversity.treatment + identity + no.discs + transect , data = mg.fall2017.1month.ch)
anova(model) #diversity, identity --> significant; transect --> marginal significance
plot(canopy.height ~ diversity.treatment, data = mg.fall2017.1month.ch)
plot(canopy.height ~ identity, data = mg.fall2017.1month.ch)

#Model 2: diversity (parsed between 3 and 5); transect removed
model = lm(canopy.height ~ no.sites + identity + no.discs, data = mg.fall2017.1month.ch)
anova(model) #identity, diversity --> significant
plot(canopy.height ~ no.sites, data = mg.fall2017.1month.ch)

#Model3: differences between mean mono and mean poly for poly 3 and poly 5 looking for overyielding
##5poly
###Data management
mg.fall2017.1month.ch.Poly5 <- filter(mg.fall2017.1month.ch, no.sites != "3")

###model
model.5poly = lm(canopy.height ~ no.sites + identity + no.discs, data=mg.fall2017.1month.ch.Poly5)
anova(model.5poly) #no.sites, identity --> significant, overyielding, not transgressive overyielding
plot(canopy.height ~ no.sites, data = mg.fall2017.1month.ch.Poly5)
plot(canopy.height ~ identity, data = mg.fall2017.1month.ch.Poly5)

##3poly
###Data management
mg.fall2017.1month.ch.Poly3 <- subset(mg.fall2017.1month.ch, identity == "Niles" | identity == "Poly 3" | identity == "West" | identity == "Nahant" )

###model
model.3poly = lm(canopy.height ~ no.sites + identity + no.discs, data=mg.fall2017.1month.ch.Poly3)
anova(model.3poly) #identity --> marginally significant, no overyielding
plot(canopy.height ~ no.sites, data = mg.fall2017.1month.ch.Poly3)
plot(canopy.height ~ identity, data = mg.fall2017.1month.den.Poly3)
```

###Discs per plot
```{r}
#Model
model = lm(no.discs ~ no.sites + identity + transect, data = mg.fall2017.1month)
anova(model) # transect:planting.date and no.sites:planting.date --> significant

bargraph.CI(x.factor = identity, response = no.discs, data = mg.fall2017.1month, legend = T, x.leg = 7, y.leg =6, ylim = c(0,6)) #spring poly5s had fewer discs remaining after 1 month
bargraph.CI(x.factor = transect, response = no.discs, data = mg.fall2017.1month, legend = T, x.leg = 7, y.leg =6, ylim = c(0,6)) #spring poly5s had fewer discs remaining after 1 month
```

##6 Month Monitoring Analysis
```{r}
#Data organization
mg.fall2017.6month <- filter(mg, mg$planting.date == "Fall.2017" & mg$sample.point == "6month")
str(mg.fall2017.6month)
```

###Shoot density
```{r}
#Data management- excluding plot with no discs remaining
mg.fall2017.6month.den <- subset(mg.fall2017.6month, shoots.per.disc > 0)

#Model 1
model = lm(no.shoots ~ diversity.treatment + identity + no.discs + transect, data = mg.fall2017.6month.den)
anova(model) #identity, no.discs --> significant
plot(shoots.per.disc ~ diversity.treatment, ylim = c(0,20), data = mg.fall2017.6month.den)
plot(shoots.per.disc ~ identity, ylim = c(0,15), data = mg.fall2017.6month.den)
bargraph.CI(x.factor = identity, response = shoots.per.disc, data = mg.fall2017.6month.den, ylim = c(0,20), ylab = "shoots per disc", xlab = "site identity")

#Model 2: diversity (parsed between 3 and 5); number of discs as covariate; transect removed
model = lm(no.shoots ~ no.sites + identity + no.discs, data=mg.fall2017.6month.den)
anova(model) #identity, no.discs, diversity(no.sites) --> significant
plot(shoots.per.disc ~ no.sites, ylim = c(0,20), data = mg.fall2017.6month.den)
bargraph.CI(x.factor = no.sites, response = shoots.per.disc, data = mg.fall2017.6month.den, ylim = c(0,20))

#Model3: differences between mean mono and mean poly for poly 3 and poly 5 looking for overyielding
##5poly
###Data management
mg.fall2017.6month.den.Poly5 <- filter(mg.fall2017.6month.den, no.sites != "3")

###model
model.5poly = lm(no.shoots ~ no.sites + identity + no.discs, data=mg.fall2017.6month.den.Poly5)

#model.5poly = lm(shoots.per.disc~ no.sites + identity, data=mg.fall2017.6month.den.Poly5)

anova(model.5poly) #no.discs, no.sites, identity --> significant; mono < poly
plot(shoots.per.disc ~ no.sites, ylim = c(0,25), data = mg.fall2017.6month.den.Poly5)
bargraph.CI(x.factor = no.sites, response = shoots.per.disc, data = mg.fall2017.6month.den.Poly5, ylim = c(0,20), ylab = "shoots per disc", xlab = "no sites per disc")
plot(shoots.per.disc ~ identity, data = mg.fall2017.6month.den.Poly5, ylim = c(0,25))
bargraph.CI(x.factor = identity, response = shoots.per.disc, data = mg.fall2017.6month.den.Poly5, ylim = c(0,15), ylab = "shoots per disc", xlab = "site identity")

##3poly
###Data management
mg.fall2017.6month.den.Poly3 <- subset(mg.fall2017.6month.den, identity == "Niles" | identity == "Poly 3" | identity == "West" | identity == "Nahant" )

###model
model.3poly = lm(no.shoots ~ no.sites + identity + no.discs, data=mg.fall2017.6month.den.Poly3)
anova(model.3poly) #no.discs and identity --> significant
bargraph.CI(x.factor = identity, response = shoots.per.disc, data = mg.fall2017.6month.den.Poly3, ylim = c(0,15), ylab = "shoots per disc", xlab = "site identity")
bargraph.CI(x.factor = no.sites, response = shoots.per.disc, data = mg.fall2017.6month.den.Poly3, ylim = c(0,20), ylab = "shoots per disc", xlab = "number sites per disc")
```

###Percent cover
```{r}
#Percent cover - differences by transect; number of discs as covariate
model = lm(percent.cover ~ diversity.treatment + identity + no.discs + transect , data = mg.fall2017.6month)
anova(model)    ##identity, no.discs are significant
plot(percent.cover ~ identity, data = mg.fall2017.6month, ylim = c(0,40))

#percent cover - differences by diversity (parsed between 3 and 5), identity; number of discs as covariate; transect removed
model = lm(percent.cover ~ no.sites + identity + no.discs, data = mg.fall2017.6month)
anova(model) #identity and no.discs significant

#****************************************************************************************************************************
```

###Canopy height
```{r}
#Data management: removing data points with canopy height of 0
mg.fall2017.6month.ch <- subset(mg.fall2017.6month, canopy.height > 0)

#Model 1: by diversity and identity; number of discs as covariate (but not sure why it matters?)
model = lm(canopy.height ~ diversity.treatment + identity + no.discs + transect , data = mg.fall2017.6month.ch)
anova(model) #no.discs, identity, and transect --> significant
bargraph.CI(x.factor = transect, response = canopy.height, data = mg.fall2017.6month.ch, ylim = c(0,30), ylab = "canopy height (cm)", xlab = "transect")
bargraph.CI(x.factor = identity, response = canopy.height, data = mg.fall2017.6month.ch, ylim = c(0,30), ylab = "canopy height (cm)", xlab = "Identity")
plot(canopy.height ~ no.discs, data = mg.fall2017.6month.ch)

#Model 2: diversity (parsed between 3 and 5); transect removed
model = lm(canopy.height ~ no.sites + identity + no.discs, data = mg.fall2017.6month.ch)
anova(model) #identity, no.discs --> significant

#Model3: differences between mean mono and mean poly for poly 3 and poly 5 looking for overyielding
###Did not analyze because no diversity effects in models
```

###Discs per plot
```{r}
#Model
model = aov(no.discs ~ no.sites + identity + transect, data = mg.fall2017.6month)
anova(model) # transect --> significant; identity marginally significant

bargraph.CI(x.factor = identity, response = no.discs, data = mg.fall2017.6month, ylim = c(0,3), ylab = "No discs per plot")
```

###Plots per grid
```{r}
model = aov(present ~ no.sites + identity + transect, data = mg.fall2017.6month)
anova(model) # Identity and transect significant

bargraph.CI(x.factor = identity, response = present, data = mg.fall2017.6month, ylim = c(0,1))
bargraph.CI(x.factor = transect, response = present, data = mg.fall2017.6month, ylim = c(0,1))
```


#****************************************************************************************************************************

#Plot Level Analyses
```{r}
mg.plot = mg %>%
  group_by(planting.date, sample.point, identity) %>%
  summarize(shoot.per.plot = mean(no.shoots, na.rm = T), discs.per.plot = mean(no.discs, na.rm = T), shoots.per.disc.mean = mean(shoots.per.disc, na.rm = T))

View(mg.plot) #Our data set matches DMFs, Hooray!


mg.full <- aov(no.discs ~ planting.date+transect+no.sites+identity, data = mg)
anova(mg.full)

p <- ggplot(mg, aes(x = sample.date, y = no.discs, fill = identity)) + 
  stat_summary(fun.y = mean, geom = "point", size = 2, aes(colour = identity), position = position_dodge(5)) +
  stat_summary(fun.data = mean_se, geom = "errorbar", aes(colour = identity), position = position_dodge(5), size = 0.5) +
  labs(x = "Date", y = "number of discs per plot") +
  theme_classic()
p
p <- ggplot(mg, aes(x = sample.date, y = shoots.per.disc, fill = identity)) + 
  stat_summary(fun.y = mean, geom = "point", size = 2, aes(colour = identity), position = position_dodge(5)) +
  stat_summary(fun.data = mean_se, geom = "errorbar", aes(colour = identity), position = position_dodge(5), size = 0.5) +
  labs(x = "Date", y = "number of shoots per disc") +
  theme_classic()
p

p <- ggplot(mg, aes(x = sample.date, y = no.shoots.3plot, fill = identity)) + 
  stat_summary(fun.y = mean, geom = "point", size = 2, aes(colour = identity), position = position_dodge(5)) +
  stat_summary(fun.data = mean_se, geom = "errorbar", aes(colour = identity), position = position_dodge(5), size = 0.5) +
  labs(x = "Date", y = "number of shoots per 1m2") +
  scale_y_continuous(breaks=seq(0,125,25), limits = c(0,125)) +
  theme_classic()
p

p <- ggplot(mg, aes(x = sample.date, y = canopy.height, fill = identity)) +
  #geom_point(aes(colour = identity)) +
  stat_summary(fun.y = mean, geom = "point", size = 2, aes(colour = identity), position = position_dodge(5)) +
  stat_summary(fun.data = mean_se, geom = "errorbar", aes(colour = identity), position = position_dodge(5), size = 0.5) +
  labs(x = "Date", y = "Canopy height (cm)") +
  scale_y_continuous(breaks=seq(0,125,25), limits = c(0,125)) +
  theme_classic()
p
```

#Post-Storm Analyses
##Data organization
```{r}
mg.post.storm <- mg %>%
  filter(yr == 2018) %>%
  filter(mo == 4)

str(mg.post.storm)
```

##Shoot density
```{r}
#Model 1: diversity poly (3&5) vs. mono
model.tukey = aov(shoots.per.disc ~ diversity.treatment + identity + planting.date + transect + diversity.treatment:planting.date + identity:planting.date + transect:planting.date, data = mg.post.storm)
anova(model.tukey)

#Model 2: diversity (parsed between 3 and 5)
model.tukey  <- aov(shoots.per.disc ~ no.sites + identity + planting.date + transect + no.sites:planting.date + identity:planting.date + transect:planting.date, data = mg.post.storm)
anova(model.tukey)
posthoc <- TukeyHSD(x=model.tukey, 'identity', conf.level=0.95)
posthoc


bargraph.CI(x.factor = planting.date, response = shoots.per.disc, data = mg.post.storm)
bargraph.CI(x.factor = identity, response = shoots.per.disc, data = mg.post.storm)

#Model 3: total shoots (diversity parsed between 2 and 5)
model.tukey  <- aov(no.shoots.3plot ~ no.sites + identity + planting.date + transect + no.sites:planting.date + identity:planting.date + transect:planting.date, data = mg.post.storm)
anova(model.tukey)

posthoc <- TukeyHSD(x=model.tukey, 'identity', conf.level=0.95)
posthoc
posthoc <- TukeyHSD(x=model.tukey, 'transect', conf.level=0.95)
posthoc
posthoc <- TukeyHSD(x=model.tukey, 'no.sites:planting.date', conf.level=0.95)
posthoc

bargraph.CI(x.factor = identity, response = no.shoots.3plot, data = mg.post.storm, ylim = c(0,75))
bargraph.CI(x.factor = transect, response = no.shoots.3plot, data = mg.post.storm, ylim = c(0,50))
bargraph.CI(x.factor = planting.date, response = no.shoots.3plot, group = no.sites, data = mg.post.storm, ylim = c(0,75), legend = T)


```

##No discs
```{r}
#Model 1: diversity poly (3&5) vs. mono
model.tukey = aov(no.discs ~ diversity.treatment + identity + planting.date + transect + diversity.treatment:planting.date + identity:planting.date + transect:planting.date, data = mg.post.storm)
anova(model.tukey)

#Model 2: diversity (parsed between 3 and 5)
model.tukey  <- aov(no.discs ~ no.sites + identity + planting.date + transect + no.sites:planting.date + identity:planting.date + transect:planting.date, data = mg.post.storm)
anova(model.tukey)

posthoc <- TukeyHSD(x=model.tukey, 'no.sites:planting.date', conf.level=0.95)
posthoc

posthoc <- TukeyHSD(x=model.tukey, 'planting.date:transect', conf.level=0.95)
posthoc

posthoc <- TukeyHSD(x=model.tukey, 'identity', conf.level=0.95)
posthoc

#Model 3: Only Identity in Model
#model.tukey  <- aov(no.discs ~ identity + planting.date + transect +  identity:planting.date + transect:planting.date, data = mg.post.storm)
#anova(model.tukey)

#posthoc <- TukeyHSD(x=model.tukey, 'identity:planting.date', conf.level=0.95)
#posthoc
#multcompLetters(posthoc$'identity:planting.date'[, "p adj"])

#Figures
bargraph.CI(x.factor = planting.date, response = no.discs, group = no.sites, data = mg.post.storm, legend = T, ylim = c(0,4))

bargraph.CI(x.factor = planting.date, response = no.discs, group = transect, data = mg.post.storm, legend = T, ylim = c(0,4))

bargraph.CI(x.factor = identity, response = no.discs, data = mg.post.storm, legend = T, ylim = c(0,6))
```

##Canopy Height
```{r}
model.tukey  <- aov(canopy.height ~ no.sites + identity + planting.date + transect + no.sites:planting.date + identity:planting.date + transect:planting.date, data = mg.post.storm)
anova(model.tukey)

posthoc <- TukeyHSD(x=model.tukey, 'identity', conf.level=0.95)
posthoc

#Figures
bargraph.CI(x.factor = planting.date, response = canopy.height, data = mg.post.storm, ylim = c(0,50))

bargraph.CI(x.factor = identity, response = canopy.height, data = mg.post.storm, ylim = c(0,50))
```



